{% extends "base.html" %}

{% block header %}
<header class="header figure-header">
    <div class="header-overlay"></div>
    <div class="header-content">
        <h1 class="header-title">{{ figure.title }}</h1>
        <div class="header-decoration">
            <div class="decoration-circle"></div>
            <div class="decoration-circle"></div>
            <div class="decoration-circle"></div>
        </div>
    </div>
</header>
{% endblock %}

{% block content %}
<style>
    /* Стили для страницы фигурки */
    :root {
        --primary: #ff6b35;
        --primary-light: #ff9e6d;
        --primary-dark: #e55a2b;
        --secondary: #7c4df4;
        --dark: #1a1a2e;
        --darker: #0f0f1a;
        --light: #f8f9fa;
        --gray: #e9ecef;
        --card-bg: rgba(26, 26, 46, 0.8);
        --card-border: rgba(255, 255, 255, 0.1);
        --shadow-sm: 0 2px 8px rgba(0,0,0,0.1);
        --shadow-md: 0 4px 20px rgba(0,0,0,0.15);
        --shadow-lg: 0 8px 40px rgba(0,0,0,0.2);
        --radius-sm: 12px;
        --radius-md: 16px;
        --radius-lg: 24px;
    }

    /* Хедер */
    .figure-header {
        background: linear-gradient(135deg, var(--dark) 0%, #16213e 100%);
        color: white;
        padding: 80px 0 40px;
        position: relative;
        overflow: hidden;
        margin-bottom: 30px;
    }

    .header-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: radial-gradient(circle at 30% 50%, rgba(124, 77, 244, 0.1) 0%, transparent 50%);
    }

    .header-content {
        position: relative;
        z-index: 2;
        text-align: center;
        max-width: 800px;
        margin: 0 auto;
        padding: 0 20px;
    }

    .header-title {
        font-size: 2.8em;
        font-weight: 800;
        margin-bottom: 20px;
        background: linear-gradient(45deg, #fff, var(--primary-light));
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        animation: glow 2s infinite alternate;
    }

    @keyframes glow {
        from { text-shadow: 0 0 10px rgba(255, 107, 53, 0.5); }
        to { text-shadow: 0 0 20px rgba(255, 107, 53, 0.8); }
    }

    .header-decoration {
        display: flex;
        justify-content: center;
        gap: 30px;
        margin-top: 20px;
    }

    .decoration-circle {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--primary);
        animation: pulse 2s infinite;
    }

    .decoration-circle:nth-child(2) {
        animation-delay: 0.4s;
        background: var(--secondary);
    }

    .decoration-circle:nth-child(3) {
        animation-delay: 0.8s;
        background: #00B4D8;
    }

    @keyframes pulse {
        0%, 100% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.5); opacity: 0.7; }
    }

    /* Основной контейнер */
    .figure-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
    }

    /* Кнопка назад */
    .back-wrapper {
        margin-bottom: 30px;
    }

    .back-button {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        color: var(--primary);
        text-decoration: none;
        font-weight: 500;
        padding: 12px 24px;
        border-radius: var(--radius-sm);
        background: rgba(255, 107, 53, 0.1);
        transition: all 0.3s ease;
    }

    .back-button:hover {
        background: rgba(255, 107, 53, 0.2);
        gap: 15px;
        transform: translateX(-5px);
    }

    /* Галерея изображений */
    .figure-gallery {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
    }

    .gallery-image {
        background: var(--card-bg);
        border: 1px solid var(--card-border);
        border-radius: var(--radius-md);
        overflow: hidden;
        transition: all 0.3s ease;
    }

    .gallery-image:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-md);
        border-color: var(--primary);
    }

    .gallery-image img {
        width: 100%;
        height: 400px;
        object-fit: cover;
        display: block;
        transition: transform 0.5s ease;
    }

    .gallery-image:hover img {
        transform: scale(1.05);
    }

    /* Детали фигурки */
    .figure-details {
        background: var(--card-bg);
        backdrop-filter: blur(10px);
        border: 1px solid var(--card-border);
        border-radius: var(--radius-lg);
        padding: 40px;
        margin-bottom: 40px;
        position: relative;
        overflow: hidden;
    }

    .figure-details::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, var(--primary), var(--secondary));
    }

    .details-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 25px;
        margin-bottom: 40px;
    }

    .detail-item {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .detail-label {
        font-size: 0.9em;
        color: rgba(255, 255, 255, 0.6);
        text-transform: uppercase;
        letter-spacing: 1px;
        font-weight: 500;
    }

    .detail-value {
        font-size: 1.4em;
        font-weight: 700;
        color: white;
    }

    .detail-value.price {
        color: var(--primary-light);
        font-size: 1.8em;
    }

    .status {
        display: inline-block;
        padding: 6px 16px;
        border-radius: 20px;
        font-size: 0.9em;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .status-available {
        background: rgba(76, 175, 80, 0.15);
        color: #4CAF50;
        border: 1px solid rgba(76, 175, 80, 0.3);
    }

    .status-reserved {
        background: rgba(255, 152, 0, 0.15);
        color: #FF9800;
        border: 1px solid rgba(255, 152, 0, 0.3);
    }

    .status-sold {
        background: rgba(244, 67, 54, 0.15);
        color: #F44336;
        border: 1px solid rgba(244, 67, 54, 0.3);
    }

    /* Описание */
    .figure-description {
        margin-bottom: 40px;
    }

    .figure-description h3 {
        font-size: 1.5em;
        color: white;
        margin-bottom: 20px;
        position: relative;
        padding-bottom: 10px;
    }

    .figure-description h3::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 60px;
        height: 3px;
        background: var(--primary);
        border-radius: 2px;
    }

    .figure-description p {
        font-size: 1.1em;
        line-height: 1.8;
        color: rgba(255, 255, 255, 0.9);
        margin: 0;
    }

    /* Кнопка "Написать автору" - ИСПРАВЛЕННАЯ */
    .figure-actions {
        text-align: center;
        padding-top: 30px;
        border-top: 1px solid var(--card-border);
    }

    .contact-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        background: linear-gradient(135deg, #0088cc 0%, #005c99 100%);
        color: white;
        text-decoration: none;
        padding: 18px 45px;
        border-radius: 50px;
        font-weight: 600;
        font-size: 1.1em;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0, 136, 204, 0.3);
        cursor: pointer;
        position: relative;
        overflow: hidden;
        border: none;
    }

    .contact-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: left 0.6s ease;
    }

    .contact-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(0, 136, 204, 0.4);
        gap: 15px;
        text-decoration: none;
        color: white;
    }

    .contact-btn:hover::before {
        left: 100%;
    }

    .contact-btn:active {
        transform: translateY(-1px);
    }

    .contact-btn i {
        font-size: 1.2em;
        transition: transform 0.3s ease;
    }

    .contact-btn:hover i {
        transform: translateX(3px);
    }

    /* Стили для внешнего вида */
    .contact-btn {
        background: linear-gradient(135deg, #0088cc 0%, #005c99 100%);
        background-size: 200% 200%;
        animation: gradient-shift 3s ease infinite;
    }

    @keyframes gradient-shift {
        0%, 100% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
    }

    /* Адаптивность */
    @media (max-width: 768px) {
        .header-title {
            font-size: 2.2em;
        }
        
        .figure-gallery {
            grid-template-columns: 1fr;
        }
        
        .gallery-image img {
            height: 350px;
        }
        
        .figure-details {
            padding: 30px 20px;
        }
        
        .details-grid {
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        
        .detail-value {
            font-size: 1.2em;
        }
        
        .detail-value.price {
            font-size: 1.5em;
        }
        
        .contact-btn {
            padding: 16px 35px;
            font-size: 1em;
            width: 100%;
            max-width: 350px;
        }
    }

    @media (max-width: 480px) {
        .header-title {
            font-size: 1.8em;
        }
        
        .figure-header {
            padding: 60px 0 30px;
        }
        
        .details-grid {
            grid-template-columns: 1fr;
        }
        
        .gallery-image img {
            height: 300px;
        }
        
        .contact-btn {
            padding: 14px 30px;
        }
        
        .figure-description p {
            font-size: 1em;
        }
    }

    /* Анимации */
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .animate-fade-in {
        animation: fadeInUp 0.6s ease;
    }
</style>

<div class="figure-container animate-fade-in">
    <!-- Кнопка назад -->
    <div class="back-wrapper">
        <a href="/collection/{{ figure.collection_id }}" class="back-button">
            <i class="fas fa-arrow-left"></i> Назад к коллекции
        </a>
    </div>

    <!-- Галерея изображений -->
    <div class="figure-gallery">
        {% for image in figure.images %}
        <div class="gallery-image">
            <img src="{{ image }}" alt="{{ figure.title }}" 
                 onerror="this.src='https://via.placeholder.com/400x400/1A1A1A/7C4DFF?text={{ figure.title|urlencode }}'">
        </div>
        {% endfor %}
    </div>

    <!-- Детали фигурки -->
    <div class="figure-details">
        <div class="details-grid">
            <div class="detail-item">
                <span class="detail-label">Цена</span>
                <span class="detail-value price">{{ figure.price }}</span>
            </div>
            <div class="detail-item">
                <span class="detail-label">Статус</span>
                <span class="status status-{{ figure.status }}">{{ figure.status_text }}</span>
            </div>
            <div class="detail-item">
                <span class="detail-label">Размер</span>
                <span class="detail-value">{{ figure.size }}</span>
            </div>
            <div class="detail-item">
                <span class="detail-label">Материал</span>
                <span class="detail-value">{{ figure.material }}</span>
            </div>
        </div>

        <div class="figure-description">
            <h3>Описание</h3>
            <p>{{ figure.description }}</p>
        </div>

        <div class="figure-actions">
            <!-- ИСПРАВЛЕННАЯ КНОПКА С РАБОЧЕЙ ССЫЛКОЙ -->
            <a href="https://t.me/dikayl" 
               target="_blank" 
               rel="noopener noreferrer" 
               class="contact-btn"
               onclick="window.open('https://t.me/dikayl', '_blank'); return false;">
                <i class="fab fa-telegram"></i> Написать автору
            </a>
        </div>
    </div>
</div>

<script>
    // Дополнительный скрипт для гарантированной работы кнопки
    document.addEventListener('DOMContentLoaded', function() {
        const contactBtn = document.querySelector('.contact-btn');
        
        if (contactBtn) {
            console.log('Contact button found:', contactBtn);
            
            // Удаляем все старые обработчики
            const newBtn = contactBtn.cloneNode(true);
            contactBtn.parentNode.replaceChild(newBtn, contactBtn);
            
            // Добавляем гарантированный обработчик
            newBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Opening Telegram...');
                
                // Двойное открытие для гарантии
                window.open('https://t.me/dikayl', '_blank');
                
                // Для мобильных устройств
                if (/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
                    window.location.href = 'tg://resolve?domain=dikayl';
                }
                
                return false;
            });
            
            // Убеждаемся что кнопка кликабельна
            newBtn.style.pointerEvents = 'auto';
            newBtn.style.cursor = 'pointer';
            newBtn.style.position = 'relative';
            newBtn.style.zIndex = '100';
        }
        
        // Добавляем анимацию для галереи
        const galleryImages = document.querySelectorAll('.gallery-image');
        galleryImages.forEach((image, index) => {
            image.style.animationDelay = `${index * 0.1}s`;
            image.classList.add('animate-fade-in');
        });
    });
</script>
{% endblock %}